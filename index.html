<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deal Analyzer – Year 1</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(180deg, #f3f4f6, #e5e7eb);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #111827;
    }
    .page { max-width: 1100px; margin: 0 auto; padding: 24px; display: flex; flex-direction: column; gap: 24px; }
    h1 { font-size: 26px; font-weight: 700; margin: 0; }
    .card {
      background: #ffffffcc;
      backdrop-filter: blur(6px);
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    }
    .muted { color: #6b7280; font-size: 12px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    label { display: flex; flex-direction: column; gap: 4px; font-size: 12px; }
    input, select { padding: 8px; border-radius: 8px; border: 1px solid #d1d5db; }
    .kpi {
      padding: 12px;
      border-radius: 12px;
      background: linear-gradient(180deg, #ffffff, #f9fafb);
      box-shadow: inset 0 0 0 1px #e5e7eb;
      display: flex; flex-direction: column; gap: 4px;
    }
    .kpi .value { font-size: 22px; font-weight: 700; }
    .positive { color: #065f46; }
    .negative { color: #991b1b; }
    .toggle { display: flex; gap: 8px; align-items: center; font-size: 13px; }
  </style>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useMemo } = React;

const fmt = n => n.toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
const fmtPct = n => (n * 100).toFixed(1) + '%';

function monthlyPI(loan, rate, years) {
  const r = rate / 12;
  const n = years * 12;
  if (rate === 0) return loan / n;
  return loan * r / (1 - Math.pow(1 + r, -n));
}

function InvestmentAnalyzer() {
  const [price, setPrice] = useState(400000);
  const [downPct, setDownPct] = useState(0.2);
  const [rate, setRate] = useState(0.07);
  const [loanType, setLoanType] = useState('Conventional');
  const [rent, setRent] = useState(4000);
  const [opexPct, setOpexPct] = useState(0.4);
  const [taxRate, setTaxRate] = useState(0.012);
  const [insuranceAnnual, setInsuranceAnnual] = useState(1400);
  const [closingPct, setClosingPct] = useState(0.02);
  const [rehab, setRehab] = useState(0);

  const [itemized, setItemized] = useState(false);
  const [vacancy, setVacancy] = useState(0.05);
  const [management, setManagement] = useState(0.08);
  const [repairs, setRepairs] = useState(0.05);
  const [capex, setCapex] = useState(0.05);
  const [hoa, setHoa] = useState(0);
  const [utilities, setUtilities] = useState(0);

  const [pmiPct, setPmiPct] = useState(0.006);
  const [vaFeePct, setVaFeePct] = useState(0.0215);

  const d = useMemo(() => {
    const down = price * downPct;
    let loan = price - down;
    if (loanType === 'VA') loan += price * vaFeePct;

    const pi = monthlyPI(loan, rate, 30);
    const taxes = price * taxRate / 12;
    const insurance = insuranceAnnual / 12;

    let mi = 0;
    if (loanType === 'Conventional' && downPct < 0.2) mi = loan * pmiPct / 12;

    const gross = rent;
    const opex = itemized
      ? gross * (vacancy + management + repairs + capex) + hoa + utilities
      : gross * opexPct;

    const piti = pi + taxes + insurance + mi;
    const cashFlow = gross - opex - piti;
    const cashToClose = down + price * closingPct + rehab;
    const coc = cashToClose > 0 ? (cashFlow * 12) / cashToClose : 0;

    return { pi, taxes, insurance, mi, opex, gross, piti, cashFlow, cashToClose, coc };
  }, [price, downPct, rate, loanType, rent, opexPct, taxRate, insuranceAnnual, closingPct, rehab, itemized, vacancy, management, repairs, capex, hoa, utilities, pmiPct, vaFeePct]);

  return (
    <div className="page">
      <h1>Deal Analyzer – Year 1</h1>

      <div className="card">
        <div className="grid-4">
          <label>Purchase Price<input type="number" value={price} onChange={e=>setPrice(+e.target.value)} /></label>
          <label>Down %<input type="number" step="0.01" value={downPct} onChange={e=>setDownPct(+e.target.value)} /></label>
          <label>Rate<input type="number" step="0.001" value={rate} onChange={e=>setRate(+e.target.value)} /></label>
          <label>Loan Type<select value={loanType} onChange={e=>setLoanType(e.target.value)}><option>Conventional</option><option>VA</option></select></label>
          <label>Monthly Rent<input type="number" value={rent} onChange={e=>setRent(+e.target.value)} /></label>
          <label>OpEx %<input type="number" step="0.01" value={opexPct} onChange={e=>setOpexPct(+e.target.value)} /></label>
          <label>Property Tax Rate<input type="number" step="0.001" value={taxRate} onChange={e=>setTaxRate(+e.target.value)} /></label>
          <label>Insurance (annual)<input type="number" value={insuranceAnnual} onChange={e=>setInsuranceAnnual(+e.target.value)} /></label>
          <label>Closing %<input type="number" step="0.01" value={closingPct} onChange={e=>setClosingPct(+e.target.value)} /></label>
          <label>Initial Rehab<input type="number" value={rehab} onChange={e=>setRehab(+e.target.value)} /></label>
        </div>

        <label className="toggle" style={{marginTop:16}}>
          <input type="checkbox" checked={itemized} onChange={e=>setItemized(e.target.checked)} />
          Itemized Expenses
        </label>

        {itemized && (
          <div className="grid-4" style={{marginTop:12}}>
            <label>Vacancy %<input type="number" step="0.01" value={vacancy} onChange={e=>setVacancy(+e.target.value)} /></label>
            <label>Management %<input type="number" step="0.01" value={management} onChange={e=>setManagement(+e.target.value)} /></label>
            <label>Repairs %<input type="number" step="0.01" value={repairs} onChange={e=>setRepairs(+e.target.value)} /></label>
            <label>CapEx %<input type="number" step="0.01" value={capex} onChange={e=>setCapex(+e.target.value)} /></label>
            <label>HOA (mo)<input type="number" value={hoa} onChange={e=>setHoa(+e.target.value)} /></label>
            <label>Utilities (mo)<input type="number" value={utilities} onChange={e=>setUtilities(+e.target.value)} /></label>
          </div>
        )}
      </div>

      <div className="card grid-3">
        <div className="kpi"><div className="muted">PITI</div><div className="value">{fmt(d.piti)}</div></div>
        <div className="kpi"><div className="muted">Monthly Cash Flow</div><div className={`value ${d.cashFlow >= 0 ? 'positive' : 'negative'}`}>{fmt(d.cashFlow)}</div></div>
        <div className="kpi"><div className="muted">Cash to Close</div><div className="value">{fmt(d.cashToClose)}</div></div>
        <div className="kpi"><div className="muted">Cash-on-Cash (Yr 1)</div><div className={`value ${d.coc >= 0 ? 'positive' : 'negative'}`}>{fmtPct(d.coc)}</div></div>
      </div>

      <div className="card">
        <div style={{fontSize:13}}>
          <div className="muted">PITI Breakdown</div>
          <div>P&I: {fmt(d.pi)}</div>
          <div>Taxes: {fmt(d.taxes)}</div>
          <div>Insurance: {fmt(d.insurance)}</div>
          <div>MI: {fmt(d.mi)}</div>
          <hr />
          <div className="muted">Cash Flow Calculation</div>
          <div>Rent: {fmt(d.gross)}</div>
          <div>Operating Expenses: {fmt(d.opex)}</div>
          <div>PITI: {fmt(d.piti)}</div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<InvestmentAnalyzer />);
</script>
</body>
</html>
